FROM node:16-alpine3.16 as builder

ARG GH_SUBSOCIAL_NODE_URL
ARG GH_IPFS_URL
ARG GH_TWITTER_CLIENT_ID
ARG GH_TWITTER_CLIENT_SECRET
ARG GH_TWITTER_BEARER_TOKEN
ARG GH_NEXTAUTH_SECRET
ARG GH_NEXT_PUBLIC_AUTH_URL
ARG GH_NEXT_PUBLIC_AUTH_HEADER
ARG GH_NEXT_PUBLIC_GA_MEASUREMENT_ID
ARG GH_NEXTAUTH_URL
ARG GH_NEXT_PUBLIC_OFFCHAIN_URL
ARG GH_NEXT_PUBLIC_P4E_SPACE

ENV NEXT_PUBLIC_SUBSOCIAL_NODE_URL=${GH_SUBSOCIAL_NODE_URL} \
    NEXT_PUBLIC_IPFS_URL=${GH_IPFS_URL} \
    TWITTER_CLIENT_ID=${GH_TWITTER_CLIENT_ID} \
    TWITTER_CLIENT_SECRET=${GH_TWITTER_CLIENT_SECRET} \
    TWITTER_BEARER_TOKEN=${GH_TWITTER_BEARER_TOKEN} \
    NEXTAUTH_SECRET=${GH_NEXTAUTH_SECRET} \
    NEXT_PUBLIC_AUTH_URL=${GH_NEXT_PUBLIC_AUTH_URL} \
    NEXT_PUBLIC_AUTH_HEADER=${GH_NEXT_PUBLIC_AUTH_HEADER} \
    NEXTAUTH_URL=${GH_NEXTAUTH_URL} \
    NEXT_PUBLIC_P4E_SPACE=${GH_NEXT_PUBLIC_P4E_SPACE} \
    NEXT_PUBLIC_OFFCHAIN_URL=${GH_NEXT_PUBLIC_OFFCHAIN_URL} \
    NEXT_PUBLIC_GA_MEASUREMENT_ID=${GH_NEXT_PUBLIC_GA_MEASUREMENT_ID}



COPY . /usr/src/app

WORKDIR /usr/src/app

RUN set -x \
    && mv ci.env .env \
    && yarn install \
    && yarn build 


EXPOSE 3000
CMD ["yarn", "start"]
